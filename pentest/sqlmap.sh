#!/bin/bash

SCAN_HOST=$1
OUTDIR=$2

# Check if the parameter is provided
if [ -z "$SCAN_HOST" ]; then
  echo "Error: Missing parameter. Please provide the SCAN HOST."
  exit 1
fi

if [ -z "$OUTDIR" ]; then
  echo "Error: Missing parameter. Please provide the output directory."
  exit 1
fi

echo "SCAN HOST is: $SCAN_HOST"
echo "OUTPUT DIRECTORY is: $OUTDIR"

if [ ! -d "${OUTDIR}" ]; then
  mkdir "${OUTDIR}"
  echo "Directory ${OUTDIR} created."
else
  echo "Directory ${OUTDIR} already exists."
fi

ACCESS_TOKEN=$(curl -s -X POST "${SCAN_HOST}/api/users/login" \
                   -H "Content-Type: application/json" \
                   -d '{"email": "khinyadanarnaing1@gmail.com", "password": "12345678"}' \
                   -i | grep -oP 'access_token=\K[^;]+')

python3 /var/lib/jenkins/sqlmap/sqlmap.py -u "${SCAN_HOST}/api/users/login" --data='{"email": "khinyadanarnaing1@gmail.com","password": "12345678"}' --cookie="access_token=${ACCESS_TOKEN}" --dbs --batch --level=2 --risk=2 --ignore-code=401 --tamper="space2comment" --output-dir=${OUTDIR} | tee "${OUTDIR}/sqlmap-1.txt"

python3 /var/lib/jenkins/sqlmap/sqlmap.py -u "${SCAN_HOST}/api/users/logout" --cookie="access_token=${ACCESS_TOKEN}" --dbs --batch --level=2 --risk=2 --ignore-code=401 --tamper="space2comment" --output-dir=${OUTDIR} | tee "${OUTDIR}/sqlmap-2.txt"

python3 /var/lib/jenkins/sqlmap/sqlmap.py -u "${SCAN_HOST}/api/users" --data='{"email": "cc@gmail.com","username": "khin","password":"12345678","password":"12345678","role":"MERCHANT","active":true}' --cookie="access_token=${ACCESS_TOKEN}" --dbs --batch --level=2 --risk=2 --ignore-code=401 --tamper="space2comment" --output-dir=${OUTDIR} | tee "${OUTDIR}/sqlmap-3.txt"

python3 /var/lib/jenkins/sqlmap/sqlmap.py -u "${SCAN_HOST}/api/users/verify" --data='{"accountVerificationCode": "7043712897498EEC7776FCA013022E61BCC807A9CFCBD96269ACBADCBDA32AA3983988882FCA62A5768568480DB4BFAD"}' --cookie="access_token=${ACCESS_TOKEN}" --dbs --batch --level=2 --risk=2 --ignore-code=401 --tamper="space2comment" --output-dir=${OUTDIR} | tee "${OUTDIR}/sqlmap-4.txt"

python3 /var/lib/jenkins/sqlmap/sqlmap.py -u "${SCAN_HOST}/api/users/otp/generate" --data='{"email": "khinyadanarnaing93@gmail.com"}' --cookie="access_token=${ACCESS_TOKEN}" --dbs --batch --level=2 --risk=2 --ignore-code=401 --ignore-code=404 --tamper="space2comment" --output-dir=${OUTDIR} | tee "${OUTDIR}/sqlmap-5.txt"

python3 /var/lib/jenkins/sqlmap/sqlmap.py -u "${SCAN_HOST}/api/users/otp/validate" --data='{"email": "khinyadanarnaing93@gmail.com","otp": "656079"}' --cookie="access_token=${ACCESS_TOKEN}" --dbs --batch --level=2 --risk=2 --ignore-code=401 --ignore-code=404 --tamper="space2comment" --output-dir=${OUTDIR} | tee "${OUTDIR}/sqlmap-6.txt"

python3 /var/lib/jenkins/sqlmap/sqlmap.py -u "${SCAN_HOST}/api/core/campaigns" --data='{"description": "Flash Light**@","startDate": "2025-09-19T23:18:50.551124","endDate": "2026-11-21T23:18:50.551124","numberOfVouchers": "3","numberOfLikes": "89","tagsJson": "", "amount": "20","tandc": "Test","store": {"storeId": "8532c153-51ff-4f89-9579-19e8572711e7"},"createdBy":"41e0c9f2-81a4-4b44-b084-90fc0c4cd35b"}' --cookie="access_token=${ACCESS_TOKEN}" --dbs --batch --level=2 --risk=2 --ignore-code=401 --tamper="space2comment" --output-dir=${OUTDIR} | tee "${OUTDIR}/sqlmap-7.txt"

python3 /var/lib/jenkins/sqlmap/sqlmap.py -u "${SCAN_HOST}/api/core/campaigns/update" --data='{"campaignId": "2f8ae5e8-1c7c-4c36-b5f5-0b18823c0327","description": "Flash Light","startDate": "2024-09-19T23:18:50.551124","endDate": "2024-11-21T23:18:50.551124","numberOfVouchers": "3","numberOfLikes": "89","tagsJson": "","amount": "20","tandc": "Test","store": {"storeId": "d7036be7-182a-49d8-814e-a3d3b693dc29"},"updatedBy": "41e0c9f2-81a4-4b44-b084-90fc0c4cd35b"}' --cookie="access_token=${ACCESS_TOKEN}" --dbs --batch --level=2 --risk=2 --ignore-code=401 --tamper="space2comment" --output-dir=${OUTDIR} | tee "${OUTDIR}/sqlmap-8.txt"

python3 /var/lib/jenkins/sqlmap/sqlmap.py -u "${SCAN_HOST}/api/core/campaigns/promote" --data='{"campaignId": "2f8ae5e8-1c7c-4c36-b5f5-0b18823c0327","userId": "22f315f8-5b54-4f48-bdc9-5c32738173c1"}' --cookie="access_token=${ACCESS_TOKEN}" --dbs --batch --level=2 --risk=2 --ignore-code=401 --tamper="space2comment" --output-dir=${OUTDIR} | tee "${OUTDIR}/sqlmap-9.txt"

python3 /var/lib/jenkins/sqlmap/sqlmap.py -u "${SCAN_HOST}/api/core/vouchers/claim" --data='{"campaignId": "0261c906-093d-4f3a-a97e-7ac64ce37743","claimedBy": "aa698a05-1212-43e8-96a0-6a72452c96ba"}' --cookie="access_token=${ACCESS_TOKEN}" --dbs --batch --level=2 --risk=2 --ignore-code=401 --tamper="space2comment" --output-dir=${OUTDIR} | tee "${OUTDIR}/sqlmap-10.txt"

python3 /var/lib/jenkins/sqlmap/sqlmap.py -u "${SCAN_HOST}/api/core/vouchers/consume" --data='{"voucherId": "1e378b48-bd79-4c02-a5de-18664c36dc52"}' --cookie="access_token=${ACCESS_TOKEN}" --dbs --batch --level=2 --risk=2 --ignore-code=401 --tamper="space2comment" --output-dir=${OUTDIR} | tee "${OUTDIR}/sqlmap-11.txt"

python3 /var/lib/jenkins/sqlmap/sqlmap.py -u "${SCAN_HOST}/api/feeds/readStatus" --data='{"feedId": "7746d0bd-fc24-45c3-8fbc-891ee79ec3fb"}' --cookie="access_token=${ACCESS_TOKEN}" --dbs --batch --level=2 --risk=2 --ignore-code=401 --tamper="space2comment" --output-dir=${OUTDIR} | tee "${OUTDIR}/sqlmap-12.txt"

python3 /var/lib/jenkins/sqlmap/sqlmap.py -u "${SCAN_HOST}/api/core/stores" --data='storeName=Own   Days&description=Create a safe and cosy environment.&address1=317 Alexandra Rd&address2=Level 1&city=Singapore&state=Singapore&country=Singapore&postalCode=159965&contactNumber=6786 6868&createdBy=741b4503-cd29-47b3-a651-bd3bc51c2e08&image=' --cookie="access_token=${ACCESS_TOKEN}" --dbs --batch --level=2 --risk=2 --ignore-code=401 --tamper="space2comment" --output-dir=${OUTDIR} | tee "${OUTDIR}/sqlmap-13.txt"

python3 /var/lib/jenkins/sqlmap/sqlmap.py -u "${SCAN_HOST}/api/users/refreshToken" --cookie="access_token=${ACCESS_TOKEN}" --dbs --batch --level=2 --risk=2 --ignore-code=401 --tamper="space2comment" --output-dir=${OUTDIR} | tee "${OUTDIR}/sqlmap-14.txt"

python3 /var/lib/jenkins/sqlmap/sqlmap.py -u "${SCAN_HOST}/api/users/google/userinfo" --cookie="access_token=${ACCESS_TOKEN}" --dbs --batch --level=2 --risk=2 --ignore-code=401 --tamper="space2comment" --output-dir=${OUTDIR} | tee "${OUTDIR}/sqlmap-15.txt"
